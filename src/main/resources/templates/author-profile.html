<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å –ê–≤—Ç–æ—Ä–∞</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            text-align: center;
        }

        header {
            background-color: #ffffff;
            color: #333;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .author-container {
            display: flex;
            justify-content: center;
            margin-top: 50px;
        }

        .author-card {
            background: #ffffff;
            padding: 20px;
            width: 350px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: left;
        }

        h2 {
            color: #007aff;
            margin-bottom: 15px;
        }

        .weather {
            margin-top: 15px;
            padding: 15px;
            background: #f1f3f5;
            border-radius: 8px;
            text-align: left;
            position: relative;
        }

        .sun {
            position: absolute;
            top: -20px;
            right: -70px;
            width: 100px;
            height: 100px;
            background: #ffeb3b;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(255, 235, 59, 0.6);
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0% {
                box-shadow: 0 0 20px rgba(255, 235, 59, 0.8), 0 0 40px rgba(255, 235, 59, 0.5);
            }
            50% {
                box-shadow: 0 0 30px rgba(255, 235, 59, 0.8), 0 0 60px rgba(255, 235, 59, 0.6);
            }
            100% {
                box-shadow: 0 0 20px rgba(255, 235, 59, 0.8), 0 0 40px rgba(255, 235, 59, 0.5);
            }
        }

        .books-list {
            margin-top: 20px;
            text-align: left;
            display: none;
        }

        .books-list ul {
            list-style-type: none;
            padding: 0;
        }

        .books-list li {
            background: #ffffff;
            margin: 5px 0;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .show-books-btn {
            margin-top: 15px;
            padding: 10px 15px;
            background: #007aff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 6px;
            font-size: 16px;
        }

        .show-books-btn:hover {
            background: #005ecb;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ */
        .form-container {
            margin-top: 30px;
            display: flex;
            justify-content: center;
        }

        .form-card {
            background: #ffffff;
            padding: 25px;
            width: 400px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: left;
        }

        .form-card h2 {
            color: #007aff;
            margin-bottom: 15px;
            font-size: 22px;
            font-weight: normal;
        }

        .input-field {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 16px;
            background: #f9f9f9;
        }

        .input-field:focus {
            border-color: #007aff;
            outline: none;
            background: #fff;
        }

        .submit-btn {
            width: 100%;
            padding: 12px 20px;
            background-color: #007aff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }

        .submit-btn:hover {
            background-color: #005ecb;
        }

    </style>
</head>
<body>

<header>
    <h1>üìö –ö–Ω–∏–∂–Ω—ã–π –ú–∞–≥–∞–∑–∏–Ω</h1>
</header>

<main>
    <div class="author-container">
        <div class="author-card">
            <h2 th:text="${author.name}">–ò–º—è –ê–≤—Ç–æ—Ä–∞</h2>
            <p><strong>–ö–Ω–∏–≥ –Ω–∞–ø–∏—Å–∞–Ω–æ:</strong> <span th:text="${author.countOfBooks}">0</span></p>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span th:text="${author.status}">–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω</span></p>

            <div class="weather">
                <h3>‚òÄÔ∏è –ü–æ–≥–æ–¥–∞:</h3>
                <p><strong>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</strong> <span id="weather-temp">‚Äî</span></p>
                <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span id="weather-desc">‚Äî</span></p>
                <div class="sun"></div>
            </div>

            <button id="show-books-btn" class="show-books-btn">üìñ –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–∏–≥–∏</button>

            <div class="books-list" id="books-container" style="display: none;">
                <h3>üìö –ö–Ω–∏–≥–∏ –∞–≤—Ç–æ—Ä–∞:</h3>
                <ul id="books-list"></ul>
            </div>

            <div class="form-container">
                <div class="form-card">
                    <h2>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–æ—Å—Ç</h2>
                    <form id="createPostForm">
                        <!-- –ü–æ–ª–µ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ—Å—Ç–∞ -->
                        <input type="text" id="postName" class="input-field" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞" required>

                        <!-- –ü–æ–ª–µ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è -->
                        <textarea id="description" class="input-field" rows="4" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" required></textarea>

                        <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è userId, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —Å –ø–æ–º–æ—â—å—é JavaScript -->
                        <input type="hidden" id="userId">

                        <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã -->
                        <button type="submit" class="submit-btn">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    document.addEventListener("DOMContentLoaded", function () {

        const pathParts1 = window.location.pathname.split('/');
        const userId = pathParts1[pathParts1.length - 1];

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ userId
        document.getElementById("userId").value = userId;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById("createPostForm").addEventListener("submit", function (event) {
            event.preventDefault(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—ã—á–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã

            // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
            const postName = document.getElementById("postName").value;
            const description = document.getElementById("description").value;
            const userId = document.getElementById("userId").value;

            // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const postData = {
                userId: userId,
                postName: postName,
                description: description
            };

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ fetch
            fetch('/api/v1/post', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(postData)
            })
                .then(response => response.json())
                .then(data => {
                    alert("–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!");
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø–æ—Å—Ç–æ–º
                })
                .catch(error => {
                    console.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞:", error);
                    alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞.");
                });
        });

        const pathParts = window.location.pathname.split('/');
        const authorId = pathParts[pathParts.length - 1];

        fetch(`/api/v1/authors/${authorId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∞.");
                }
                return response.json();
            })
            .then(data => {
                if (data.weatherDTO) {
                    document.getElementById("weather-temp").textContent = `${data.weatherDTO.temperature}¬∞C`;
                    document.getElementById("weather-desc").textContent = data.weatherDTO.description;
                }
            })
            .catch(error => {
                console.error(error);
                document.getElementById("weather-temp").textContent = "–î–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã";
                document.getElementById("weather-desc").textContent = "–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω";
            });


        const showBooksButton = document.getElementById("show-books-btn");
        const booksContainer = document.getElementById("books-container");
        const booksList = document.getElementById("books-list");

        showBooksButton.addEventListener("click", function () {
            if (booksContainer.style.display === "none") {
                booksContainer.style.display = "block";

                fetch(`/api/v1/books/author/${authorId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –∫–Ω–∏–≥.");
                        }
                        return response.json();
                    })
                    .then(books => {
                        booksList.innerHTML = "";
                        if (books.length === 0) {
                            booksList.innerHTML = "<li>–£ –∞–≤—Ç–æ—Ä–∞ –ø–æ–∫–∞ –Ω–µ—Ç –∫–Ω–∏–≥.</li>";
                        } else {
                            books.forEach(book => {
                                const li = document.createElement("li");
                                li.innerHTML = `<strong>${book.name}</strong> ‚Äî <em>${book.article}</em>`;
                                booksList.appendChild(li);
                            });
                        }
                    })
                    .catch(error => {
                        console.error(error);
                        booksList.innerHTML = "<li>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥.</li>";
                    });
            } else {
                booksContainer.style.display = "none";
            }
        });
    });
</script>

</body>
</html>
