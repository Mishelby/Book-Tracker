<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å –ê–≤—Ç–æ—Ä–∞</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        body {
            font-family: 'Georgia', serif;
            background-color: #f5f0e1;
            margin: 0;
            padding: 0;
            text-align: center;
            overflow: hidden;
        }

        header {
            background-color: #4A90E2;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }

        .author-container {
            display: flex;
            justify-content: center;
            margin-top: 50px;
        }

        .author-card {
            background: white;
            padding: 20px;
            width: 350px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #ff6347; /* –¢–æ–º–∞—Ç–Ω—ã–π */
            margin-bottom: 15px;
        }

        .weather {
            margin-top: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
            text-align: left;
            position: relative;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–ª–Ω—Ü–∞ */
        .sun {
            position: absolute;
            top: -20px;
            right: -70px;
            width: 100px;
            height: 100px;
            background: #ffeb3b; /* –Ø—Ä–∫–æ-–∂–µ–ª—Ç–æ–µ —Å–æ–ª–Ω—Ü–µ */
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(255, 235, 59, 0.6);
            animation: glow 2s ease-in-out infinite;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–ª—É—á–µ–Ω–∏—è –æ—Ç —Å–æ–ª–Ω—Ü–∞ */
        @keyframes glow {
            0% {
                box-shadow: 0 0 20px rgba(255, 235, 59, 0.8), 0 0 40px rgba(255, 235, 59, 0.5);
            }
            50% {
                box-shadow: 0 0 30px rgba(255, 235, 59, 0.8), 0 0 60px rgba(255, 235, 59, 0.6);
            }
            100% {
                box-shadow: 0 0 20px rgba(255, 235, 59, 0.8), 0 0 40px rgba(255, 235, 59, 0.5);
            }
        }

        .books-list {
            margin-top: 20px;
            text-align: left;
            display: none;
        }

        .books-list ul {
            list-style-type: none;
            padding: 0;
        }

        .books-list li {
            background: #ffebcd; /* –¶–≤–µ—Ç –∫—Ä–µ–º–∞ */
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .show-books-btn {
            margin-top: 15px;
            padding: 10px 15px;
            background: #ff6347; /* –Ø—Ä–∫–æ-–∫—Ä–∞—Å–Ω—ã–π */
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        }

        .show-books-btn:hover {
            background: #e55347;
        }
    </style>
</head>
<body>

<header>
    <h1>üìö –ö–Ω–∏–∂–Ω—ã–π –ú–∞–≥–∞–∑–∏–Ω</h1>
</header>

<main>
    <div class="author-container">
        <div class="author-card">
            <h2 th:text="${author.name}">–ò–º—è –ê–≤—Ç–æ—Ä–∞</h2>
            <p><strong>–ö–Ω–∏–≥ –Ω–∞–ø–∏—Å–∞–Ω–æ:</strong> <span th:text="${author.countOfBooks}">0</span></p>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span th:text="${author.status}">–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω</span></p>

            <!-- –ë–ª–æ–∫ –ø–æ–≥–æ–¥—ã -->
            <div class="weather">
                <h3>‚òÄÔ∏è –ü–æ–≥–æ–¥–∞:</h3>
                <p><strong>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</strong> <span id="weather-temp">‚Äî</span></p>
                <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span id="weather-desc">‚Äî</span></p>
                <!-- –°–æ–ª–Ω—Ü–µ -->
                <div class="sun"></div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫–Ω–∏–≥ -->
            <button id="show-books-btn" class="show-books-btn">üìñ –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–∏–≥–∏</button>

            <!-- –°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ -->
            <div class="books-list" id="books-container" style="display: none;">
                <h3>üìö –ö–Ω–∏–≥–∏ –∞–≤—Ç–æ—Ä–∞:</h3>
                <ul id="books-list">
                    <!-- –°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è JavaScript -->
                </ul>
            </div>
        </div>
    </div>
</main>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Extract the ID from the URL path
        const pathParts = window.location.pathname.split('/');
        const authorId = pathParts[pathParts.length - 1]; // Get the last part of the path

        if (!authorId) {
            alert("–ù–µ —É–∫–∞–∑–∞–Ω ID –∞–≤—Ç–æ—Ä–∞ –≤ URL. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URL —Å–æ–¥–µ—Ä–∂–∏—Ç ID, –Ω–∞–ø—Ä–∏–º–µ—Ä: /authors/1");
            return; // Stop execution if ID is missing
        }

        console.log("ID –∞–≤—Ç–æ—Ä–∞:", authorId); // For debugging purposes

        // Fetch author profile data (including weather)
        fetch(`/api/v1/authors/${authorId}`)
            .then(response => response.json())
            .then(data => {
                if (data.weatherDTO) {
                    document.getElementById("weather-temp").textContent = `${data.weatherDTO.temperature}¬∞C`;
                    document.getElementById("weather-desc").textContent = data.weatherDTO.description;
                } else {
                    document.getElementById("weather-temp").textContent = "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
                    document.getElementById("weather-desc").textContent = "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö";
                }
            })
            .catch(error => console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∞:", error));

        // Handle "Show Books" button
        const showBooksButton = document.getElementById("show-books-btn");
        const booksContainer = document.getElementById("books-container");
        const booksList = document.getElementById("books-list");

        showBooksButton.addEventListener("click", function () {
            if (booksContainer.style.display === "none") {
                booksContainer.style.display = "block";

                // Fetch author books
                fetch(`/api/v1/books/author/${authorId}`)
                    .then(response => response.json())
                    .then(books => {
                        booksList.innerHTML = ""; // Clear the list before adding new data
                        if (books.length === 0) {
                            booksList.innerHTML = "<li>–£ –∞–≤—Ç–æ—Ä–∞ –ø–æ–∫–∞ –Ω–µ—Ç –∫–Ω–∏–≥.</li>";
                        } else {
                            books.forEach(book => {
                                const li = document.createElement("li");
                                li.innerHTML = `<strong>${book.name}</strong> ‚Äî <em>${book.article}</em>`;
                                booksList.appendChild(li);
                            });
                        }
                    })
                    .catch(error => console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥:", error));
            } else {
                booksContainer.style.display = "none";
            }
        });
    });
</script>

</body>
</html>
